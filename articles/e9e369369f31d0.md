---
title: "AWS Bedrock Responses API ã®æ¤œè¨¼"
emoji: "ğŸ”¬"
type: "tech"
topics: ["aws", "bedrock", "lambda", "gpt", "mcp"]
published: false
---

# AWS Bedrock Responses API æ¤œè¨¼

AWS Bedrock ã® Responses API ã‚’æ´»ç”¨ã—ãŸ Lambda MCP çµ±åˆã«ã¤ã„ã¦ã€å®Ÿè£…ãƒ¬ãƒ™ãƒ«ã§è©³ç´°ã«æ¤œè¨¼ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€**å®Ÿéš›ã® JSON-RPC ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒšã‚¢**ã‚’ç¤ºã—ãªãŒã‚‰ã€OpenAI GPT-OSS ãƒ¢ãƒ‡ãƒ«ã§ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ Tool Use ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

## Responses API

"Responses API" ã¨ã„ã†åç§°ã¯ AWS Bedrock ã®å…¬å¼ API åã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒå‘¼ç§°ã—æ˜“ã„ãŸã‚æœ¬è¨˜äº‹ã§ã¯ã“ã®åç§°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚[Use a tool to complete an Amazon Bedrock model response](https://docs.aws.amazon.com/bedrock/latest/userguide/tool-use.html) ã«ã‚ˆã‚‹ã¨ã€ã“ã® API ã¯ OpenAI äº’æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚ã‚Šã€OpenAI GPT-OSS ãƒ¢ãƒ‡ãƒ«å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

**å¯¾å¿œãƒ¢ãƒ‡ãƒ«**: `openai.gpt-oss-20b-1:0` ãŠã‚ˆã³ `openai.gpt-oss-120b-1:0` ã®ã¿

**èªè¨¼**: AWS Signature Version 4 ãŒå¿…è¦ï¼ˆIAM ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰

## æ¤œè¨¼ç’°å¢ƒ

- **AWS Lambda**: Standardï¼ˆVPC ãªã—ï¼‰ã¨ VPC å†…ã® 2 ãƒ‘ã‚¿ãƒ¼ãƒ³
- **Lambda Runtime**: Python 3.12
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: us-east-1
- **ãƒ¢ãƒ‡ãƒ«**: openai.gpt-oss-120b-1:0

## æ¤œè¨¼çµæœ

### Test 1: OpenAI äº’æ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŸºæœ¬å‘¼ã³å‡ºã—

Responses API ã«å¯¾ã—ã¦åŸºæœ¬çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€GPT-OSS ãƒ¢ãƒ‡ãƒ«ãŒæ­£å¸¸ã«å¿œç­”ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

**REQUEST:**

```json
{
  "messages": [
    {
      "role": "user",
      "content": "Hello! Please respond briefly."
    }
  ],
  "max_tokens": 100,
  "temperature": 0.7
}
```

**RESPONSE:**

```json
{
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<reasoning>The user says: \"Hello! Please respond briefly.\" So we need a brief response. Probably greeting.</reasoning>Hi there! ğŸ‘‹ How can I help you today?",
        "refusal": null,
        "role": "assistant"
      }
    }
  ],
  "created": 1770282375,
  "id": "chatcmpl-7a0902bb-4354-4302-a6c8-409ab87147be",
  "model": "openai.gpt-oss-120b-1:0",
  "object": "chat.completion",
  "service_tier": "default",
  "usage": {
    "completion_tokens": 43,
    "prompt_tokens": 71,
    "total_tokens": 114
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚GPT-OSS ãƒ¢ãƒ‡ãƒ«ã¯ `<reasoning>` ã‚¿ã‚°ã§æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ˜ç¤ºçš„ã«å‡ºåŠ›ã™ã‚‹ç‰¹æ€§ãŒã‚ã‚Šã€ãƒ¢ãƒ‡ãƒ«ã®æ€è€ƒéç¨‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

---

### Test 2: Lambda MCP - tools/list

AWS Lambda ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ã€MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã® `tools/list` ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

https://modelcontextprotocol.io/specification/2025-11-25/basic

:::message
å³å¯†ã«ã¯ MCP ã®å®šç¾©ã™ã‚‹ JSON-RPC 2.0 ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã‚ãªã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ã‚ãˆã¦ä½œã£ã¦å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚Bedrock API ãŒ MCP ã®å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ¬ã‚¤ãƒ¤ã«ä»‹åœ¨ã™ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã§ã™ã€‚ä»¥é™ã®å®Ÿé¨“ã§ä½¿ã†ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯æœ¬ç•ªã® MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æ¥ç¶šã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§æ­£ã—ã„ MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

```json
{
  jsonrpc: "2.0";
  id: string | number;
  method: string;
  params?: {
    [key: string]: unknown;
  };
}
```
:::

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/list",
  "tenant_id": "tenant-test-001",
  "metadata": {
    "test": "responses-api",
    "timestamp": "2026-02-05"
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "get_weather",
        "description": "Get current weather for a specified location. Returns temperature, condition, humidity, and wind speed.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "City name, e.g., 'Tokyo', 'New York', 'London'"
            },
            "unit": {
              "type": "string",
              "enum": ["celsius", "fahrenheit"],
              "description": "Temperature unit (default: celsius)"
            }
          },
          "required": ["location"]
        }
      },
      {
        "name": "calculator",
        "description": "Evaluate a mathematical expression. Supports basic arithmetic operations.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "expression": {
              "type": "string",
              "description": "Mathematical expression, e.g., '2 + 2', '10 * 5', '(3 + 7) / 2'"
            }
          },
          "required": ["expression"]
        }
      },
      {
        "name": "echo_metadata",
        "description": "Echo back custom attributes to verify metadata propagation",
        "inputSchema": {
          "type": "object",
          "properties": {
            "message": {
              "type": "string",
              "description": "Message to echo back"
            }
          },
          "required": ["message"]
        }
      }
    ],
    "metadata": {
      "lambda_type": "standard",
      "received_attributes": ["tenant_id", "metadata"]
    }
  },
  "custom_attributes": {
    "tenant_id": "tenant-test-001",
    "metadata": {
      "test": "responses-api",
      "timestamp": "2026-02-05"
    }
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚3 ã¤ã®ãƒ„ãƒ¼ãƒ«ï¼ˆget_weatherã€calculatorã€echo_metadataï¼‰ãŒè¿”å´ã•ã‚Œã¾ã™ã€‚

---

### Test 3: Lambda MCP - tools/call (calculator)

MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã® `tools/call` ãƒ¡ã‚½ãƒƒãƒ‰ã§ calculator ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/call",
  "tenant_id": "tenant-test-001",
  "user_id": "user-test-001",
  "params": {
    "name": "calculator",
    "arguments": {
      "expression": "42 * 42"
    }
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "{\n  \"expression\": \"42 * 42\",\n  \"result\": 1764.0,\n  \"source\": \"lambda-standard\",\n  \"custom_attributes\": {\n    \"tenant_id\": \"tenant-test-001\",\n    \"user_id\": \"user-test-001\"\n  }\n}"
      }
    ]
  },
  "custom_attributes": {
    "tenant_id": "tenant-test-001",
    "user_id": "user-test-001"
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚42 Ã— 42 = 1764 ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã€ã‚«ã‚¹ã‚¿ãƒ å±æ€§ï¼ˆtenant_idã€user_idï¼‰ãŒ 2 ç®‡æ‰€ã«ä¼æ’­ã—ã¦ã„ã¾ã™ã€‚

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«**: `custom_attributes` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **ãƒ„ãƒ¼ãƒ«çµæœå†…**: `result.content[0].text` å†…ã® JSON ã«å«ã¾ã‚Œã‚‹ `custom_attributes`

---

### Test 4: VPC Lambda

VPC å†…ã«é…ç½®ã•ã‚ŒãŸ AWS Lambda ãŒ Responses API ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 4,
  "method": "tools/call",
  "tenant_id": "tenant-vpc-test",
  "params": {
    "name": "vpc_info",
    "arguments": {
      "detail": true
    }
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 4,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "{\n  \"execution_environment\": \"VPC\",\n  \"source\": \"lambda-vpc\",\n  \"vpc_enabled\": true,\n  \"environment\": {\n    \"AWS_REGION\": \"us-east-1\",\n    \"AWS_EXECUTION_ENV\": \"AWS_Lambda_python3.12\",\n    \"vpc_id\": \"configured_at_deployment\",\n    \"subnet_ids\": \"configured_at_deployment\"\n  },\n  \"custom_attributes\": {\n    \"tenant_id\": \"tenant-vpc-test\"\n  }\n}"
      }
    ]
  },
  "custom_attributes": {
    "tenant_id": "tenant-vpc-test"
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚VPC å†…ã® Lambda ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã€ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ VPC ã®è¨­å®šæƒ…å ±ã‚’å–å¾—ã§ãã¾ã—ãŸã€‚Standard Lambda ã¨åŒã˜æ–¹æ³•ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã€VPC å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹ï¼ˆAmazon RDSã€Amazon ElastiCache ãªã©ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

---

### Test 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

10 å›ã®é€£ç¶šå®Ÿè¡Œã§ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’æ¸¬å®šã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

```
å®Ÿè¡Œ 1: 20.41 ms
å®Ÿè¡Œ 2: 44.99 ms
å®Ÿè¡Œ 3: 23.25 ms
å®Ÿè¡Œ 4: 18.10 ms
å®Ÿè¡Œ 5: 19.18 ms
å®Ÿè¡Œ 6: 19.33 ms
å®Ÿè¡Œ 7: 18.42 ms
å®Ÿè¡Œ 8: 18.51 ms
å®Ÿè¡Œ 9: 18.41 ms
å®Ÿè¡Œ 10: 19.23 ms

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœ:
  ã‚¦ã‚©ãƒ¼ãƒ å¹³å‡: 22.16 ms
  æœ€å°å€¤: 18.10 ms
  æœ€å¤§å€¤: 44.99 ms
  å…¨ä½“å¹³å‡: 21.98 ms
```

**æ¤œè¨¼çµæœ**: ã‚¦ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã§ã¯ 18ã€œ23ms ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’è¦³æ¸¬ã—ã¾ã—ãŸã€‚ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã¯ç´„ 300ms ç¨‹åº¦ã§ã—ãŸãŒ Lambda é–¢æ•°ç­‰ã®çŠ¶æ³ã«ä¾å­˜ã™ã‚‹ãŸã‚ã‚ãã¾ã§ã“ã‚Œã‚‰ã®å€¤ã¯å‚è€ƒå€¤ã§ã™ã€‚

---

### Test 6: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºä¸Šé™

Lambda ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®ä¸Šé™ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

| ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚º | å®Ÿéš›ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º | çµæœ | å‚™è€ƒ |
|------------|----------------------|------|------|
| 1 KB | 1,042 bytes | æˆåŠŸ | - |
| 10 KB | 10,258 bytes | æˆåŠŸ | - |
| 100 KB | 102,418 bytes | æˆåŠŸ | - |
| 1 MB | 1,048,594 bytes | æˆåŠŸ | - |
| 5 MB | 5,242,898 bytes | Lambda ã‚¨ãƒ©ãƒ¼ | Response payload size exceeded maximum allowed payload size (6291556 bytes) |
| 6 MB | 6,291,474 bytes | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | RequestEntityTooLargeException |
| 7 MB | 7,340,050 bytes | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼ | RequestEntityTooLargeException |


**æ¤œè¨¼çµæœ**: Lambda åŒæœŸå‘¼ã³å‡ºã—ã®ä¸Šé™ã¯ **6 MB** ãªã®ã§ **5 MB** ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ Lambda ã«åˆ°é”ã™ã‚‹ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚µã‚¤ã‚ºã¨ã®åˆè¨ˆã§ 6 MB ã‚’è¶…ãˆã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã—ã¾ã—ãŸã€‚

---

### Test 7: GPT-OSS ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ä¸Šé™

GPT-OSS 120B ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·ï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ï¼‰ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

| ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚º | ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚º | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º | **å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³** | çµæœ |
|------------|--------------|----------------|------------|------|
| 1K æ–‡å­— | 1,003 æ–‡å­— | 1,113 bytes | 259 | æˆåŠŸ |
| 10K æ–‡å­— | 10,030 æ–‡å­— | 10,140 bytes | 1,942 | æˆåŠŸ |
| 50K æ–‡å­— | 50,327 æ–‡å­— | 50,437 bytes | 9,455 | æˆåŠŸ |
| 200K æ–‡å­— | 201,367 æ–‡å­— | 201,477 bytes | 37,615 | æˆåŠŸ |
| 300K æ–‡å­— | 302,080 æ–‡å­— | 302,190 bytes | 56,392 | æˆåŠŸ |
| 400K æ–‡å­— | 402,734 æ–‡å­— | 402,844 bytes | 75,158 | æˆåŠŸ |
| 500K æ–‡å­— | 503,447 æ–‡å­— | 503,557 bytes | 93,935 | æˆåŠŸ |
| **685K æ–‡å­—** | **689,710 æ–‡å­—** | **689,820 bytes** | **128,662** | **æˆåŠŸ** |

---

## ã¾ã¨ã‚

| é …ç›® | åˆ¶ç´„å€¤ | å‚™è€ƒ |
|------|-------|------|
| å¯¾å¿œãƒ¢ãƒ‡ãƒ« | GPT-OSS 20B/120B ã®ã¿ | - |
| Lambda ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¸Šé™ | 6 MB | AWS ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ |
| Lambda ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¸Šé™ | 6 MB | AWS ã‚µãƒ¼ãƒ“ã‚¹åˆ¶é™ |
| GPT-OSS 120B ãƒˆãƒ¼ã‚¯ãƒ³æ•° | 128K ãƒˆãƒ¼ã‚¯ãƒ³ | - |
| ã‚¦ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ | ç´„ 22 ms | - |
| Lambda ARN æŒ‡å®š | Lambda ARN ã®ã¿ | Function URL ã¯éå¯¾å¿œ |
| èªè¨¼ | AWS Signature V4 | IAM ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- AWS Bedrock Tool Use ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.aws.amazon.com/bedrock/latest/userguide/tool-use.html
- Model Context Protocol ä»•æ§˜: https://modelcontextprotocol.io/
- AWS Lambda VPC è¨­å®šãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹: https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html
- JSON-RPC 2.0 ä»•æ§˜: https://www.jsonrpc.org/specification
