---
title: "AWS Bedrock Responses API ã®æ¤œè¨¼"
emoji: "ğŸ”¬"
type: "tech"
topics: ["aws", "bedrock", "lambda", "gpt", "mcp"]
published: false
---

# AWS Bedrock Responses API æ¤œè¨¼

AWS Bedrock ã® Responses API ã‚’æ´»ç”¨ã—ãŸ Lambda MCP çµ±åˆã«ã¤ã„ã¦ã€å®Ÿè£…ãƒ¬ãƒ™ãƒ«ã§è©³ç´°ã«æ¤œè¨¼ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€**å®Ÿéš›ã® JSON-RPC ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒšã‚¢**ã‚’ç¤ºã—ãªãŒã‚‰ã€OpenAI GPT-OSS ãƒ¢ãƒ‡ãƒ«ã§ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ Tool Use ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

## Responses API

"Responses API" ã¨ã„ã†åç§°ã¯ AWS Bedrock ã®å…¬å¼ API åã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒå‘¼ç§°ã—æ˜“ã„ãŸã‚æœ¬è¨˜äº‹ã§ã¯ã“ã®åç§°ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚[Use a tool to complete an Amazon Bedrock model response](https://docs.aws.amazon.com/bedrock/latest/userguide/tool-use.html) ã«ã‚ˆã‚‹ã¨ã€ã“ã® API ã¯ OpenAI äº’æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚ã‚Šã€OpenAI GPT-OSS ãƒ¢ãƒ‡ãƒ«å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

**å¯¾å¿œãƒ¢ãƒ‡ãƒ«**: `openai.gpt-oss-20b-1:0` ãŠã‚ˆã³ `openai.gpt-oss-120b-1:0` ã®ã¿

**èªè¨¼**: AWS Signature Version 4 ãŒå¿…è¦ï¼ˆIAM ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰

## æ¤œè¨¼ç’°å¢ƒ

- **AWS Lambda**: Standardï¼ˆVPC ãªã—ï¼‰ã¨ VPC å†…ã® 2 ãƒ‘ã‚¿ãƒ¼ãƒ³
- **Lambda Runtime**: Python 3.12
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: us-east-1
- **ãƒ¢ãƒ‡ãƒ«**: openai.gpt-oss-120b-1:0

## æ¤œè¨¼çµæœ

### Test 1: OpenAI äº’æ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŸºæœ¬å‘¼ã³å‡ºã—

Responses API ã«å¯¾ã—ã¦åŸºæœ¬çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€GPT-OSS ãƒ¢ãƒ‡ãƒ«ãŒæ­£å¸¸ã«å¿œç­”ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

**REQUEST:**

```json
{
  "messages": [
    {
      "role": "user",
      "content": "Hello! Please respond briefly."
    }
  ],
  "max_tokens": 100,
  "temperature": 0.7
}
```

**RESPONSE:**

```json
{
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<reasoning>The user says: \"Hello! Please respond briefly.\" So we need a brief response. Probably greeting.</reasoning>Hi there! ğŸ‘‹ How can I help you today?",
        "refusal": null,
        "role": "assistant"
      }
    }
  ],
  "created": 1770282375,
  "id": "chatcmpl-7a0902bb-4354-4302-a6c8-409ab87147be",
  "model": "openai.gpt-oss-120b-1:0",
  "object": "chat.completion",
  "service_tier": "default",
  "usage": {
    "completion_tokens": 43,
    "prompt_tokens": 71,
    "total_tokens": 114
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚GPT-OSS ãƒ¢ãƒ‡ãƒ«ã¯ `<reasoning>` ã‚¿ã‚°ã§æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ˜ç¤ºçš„ã«å‡ºåŠ›ã™ã‚‹ç‰¹æ€§ãŒã‚ã‚Šã€ãƒ¢ãƒ‡ãƒ«ã®æ€è€ƒéç¨‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

---

### Test 2: Lambda MCP - tools/list

AWS Lambda ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ã€MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã® `tools/list` ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

https://modelcontextprotocol.io/specification/2025-11-25/basic

:::message
å³å¯†ã«ã¯ MCP ã®å®šç¾©ã™ã‚‹ JSON-RPC 2.0 ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¾“ã‚ãªã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ã‚ãˆã¦ä½œã£ã¦å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚Bedrock API ãŒ MCP ã®å®šç¾©ã™ã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ¬ã‚¤ãƒ¤ã«ä»‹åœ¨ã™ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã§ã™ã€‚ä»¥é™ã®å®Ÿé¨“ã§ä½¿ã†ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯æœ¬ç•ªã® MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æ¥ç¶šã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§æ­£ã—ã„ MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

```json
{
  jsonrpc: "2.0";
  id: string | number;
  method: string;
  params?: {
    [key: string]: unknown;
  };
}
```
:::

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/list",
  "tenant_id": "tenant-test-001",
  "metadata": {
    "test": "responses-api",
    "timestamp": "2026-02-05"
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [
      {
        "name": "get_weather",
        "description": "Get current weather for a specified location. Returns temperature, condition, humidity, and wind speed.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "City name, e.g., 'Tokyo', 'New York', 'London'"
            },
            "unit": {
              "type": "string",
              "enum": ["celsius", "fahrenheit"],
              "description": "Temperature unit (default: celsius)"
            }
          },
          "required": ["location"]
        }
      },
      {
        "name": "calculator",
        "description": "Evaluate a mathematical expression. Supports basic arithmetic operations.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "expression": {
              "type": "string",
              "description": "Mathematical expression, e.g., '2 + 2', '10 * 5', '(3 + 7) / 2'"
            }
          },
          "required": ["expression"]
        }
      },
      {
        "name": "echo_metadata",
        "description": "Echo back custom attributes to verify metadata propagation",
        "inputSchema": {
          "type": "object",
          "properties": {
            "message": {
              "type": "string",
              "description": "Message to echo back"
            }
          },
          "required": ["message"]
        }
      }
    ],
    "metadata": {
      "lambda_type": "standard",
      "received_attributes": ["tenant_id", "metadata"]
    }
  },
  "custom_attributes": {
    "tenant_id": "tenant-test-001",
    "metadata": {
      "test": "responses-api",
      "timestamp": "2026-02-05"
    }
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚3 ã¤ã®ãƒ„ãƒ¼ãƒ«ï¼ˆget_weatherã€calculatorã€echo_metadataï¼‰ãŒè¿”å´ã•ã‚Œã¾ã™ã€‚

---

### Test 3: Lambda MCP - tools/call (calculator)

MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã® `tools/call` ãƒ¡ã‚½ãƒƒãƒ‰ã§ calculator ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/call",
  "tenant_id": "tenant-test-001",
  "user_id": "user-test-001",
  "params": {
    "name": "calculator",
    "arguments": {
      "expression": "42 * 42"
    }
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "{\n  \"expression\": \"42 * 42\",\n  \"result\": 1764.0,\n  \"source\": \"lambda-standard\",\n  \"custom_attributes\": {\n    \"tenant_id\": \"tenant-test-001\",\n    \"user_id\": \"user-test-001\"\n  }\n}"
      }
    ]
  },
  "custom_attributes": {
    "tenant_id": "tenant-test-001",
    "user_id": "user-test-001"
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚42 Ã— 42 = 1764 ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã€ã‚«ã‚¹ã‚¿ãƒ å±æ€§ï¼ˆtenant_idã€user_idï¼‰ãŒ 2 ç®‡æ‰€ã«ä¼æ’­ã—ã¦ã„ã¾ã™ã€‚

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¬ãƒ™ãƒ«**: `custom_attributes` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
- **ãƒ„ãƒ¼ãƒ«çµæœå†…**: `result.content[0].text` å†…ã® JSON ã«å«ã¾ã‚Œã‚‹ `custom_attributes`

---

### Test 4: VPC Lambda

VPC å†…ã«é…ç½®ã•ã‚ŒãŸ AWS Lambda ãŒ Responses API ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

**REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 4,
  "method": "tools/call",
  "tenant_id": "tenant-vpc-test",
  "params": {
    "name": "vpc_info",
    "arguments": {
      "detail": true
    }
  }
}
```

**RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 4,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "{\n  \"execution_environment\": \"VPC\",\n  \"source\": \"lambda-vpc\",\n  \"vpc_enabled\": true,\n  \"environment\": {\n    \"AWS_REGION\": \"us-east-1\",\n    \"AWS_EXECUTION_ENV\": \"AWS_Lambda_python3.12\",\n    \"vpc_id\": \"configured_at_deployment\",\n    \"subnet_ids\": \"configured_at_deployment\"\n  },\n  \"custom_attributes\": {\n    \"tenant_id\": \"tenant-vpc-test\"\n  }\n}"
      }
    ]
  },
  "custom_attributes": {
    "tenant_id": "tenant-vpc-test"
  }
}
```

**æ¤œè¨¼çµæœ**: æˆåŠŸã€‚VPC å†…ã® Lambda ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã€ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ VPC ã®è¨­å®šæƒ…å ±ã‚’å–å¾—ã§ãã¾ã—ãŸã€‚Standard Lambda ã¨åŒã˜æ–¹æ³•ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã€VPC å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹ï¼ˆAmazon RDSã€Amazon ElastiCache ãªã©ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

---

### Test 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

10 å›ã®é€£ç¶šå®Ÿè¡Œã§ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’æ¸¬å®šã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

```
å®Ÿè¡Œ 1: 20.41 ms
å®Ÿè¡Œ 2: 44.99 ms
å®Ÿè¡Œ 3: 23.25 ms
å®Ÿè¡Œ 4: 18.10 ms
å®Ÿè¡Œ 5: 19.18 ms
å®Ÿè¡Œ 6: 19.33 ms
å®Ÿè¡Œ 7: 18.42 ms
å®Ÿè¡Œ 8: 18.51 ms
å®Ÿè¡Œ 9: 18.41 ms
å®Ÿè¡Œ 10: 19.23 ms

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœ:
  ã‚¦ã‚©ãƒ¼ãƒ å¹³å‡: 22.16 ms
  æœ€å°å€¤: 18.10 ms
  æœ€å¤§å€¤: 44.99 ms
  å…¨ä½“å¹³å‡: 21.98 ms
```

**æ¤œè¨¼çµæœ**: ã‚¦ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã§ã¯ 18ã€œ23ms ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã‚’è¦³æ¸¬ã—ã¾ã—ãŸã€‚

---

### Test 6: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºä¸Šé™

Lambda ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®ä¸Šé™ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

| ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚º | å®Ÿéš›ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º | çµæœ |
|------------|----------------------|------|
| 1 KB | 1,042 bytes | æˆåŠŸ |
| 10 KB | 10,258 bytes | æˆåŠŸ |
| 100 KB | 102,418 bytes | æˆåŠŸ |
| 1,024 KB (1 MB) | 1,048,594 bytes | æˆåŠŸ |

**æ¤œè¨¼çµæœ**: 1 MB ã¾ã§ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œã¾ã—ãŸã€‚Lambda åŒæœŸå‘¼ã³å‡ºã—ã®ä¸Šé™ã¯ 6 MB ã§ã™ã€‚

---

### Test 8: GPT-OSS ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ä¸Šé™

GPT-OSS 120B ãƒ¢ãƒ‡ãƒ«ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·ï¼ˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ï¼‰ã‚’æ®µéšçš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸã€‚

**æ¸¬å®šçµæœ:**

| ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚º | ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚º | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º | å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ | çµæœ |
|------------|--------------|----------------|------------|------|
| 1K æ–‡å­— | 1,003 æ–‡å­— | 1,115 bytes | 261 | âœ… æˆåŠŸ |
| 10K æ–‡å­— | 10,030 æ–‡å­— | 10,142 bytes | 1,944 | âœ… æˆåŠŸ |
| 50K æ–‡å­— | 50,327 æ–‡å­— | 50,439 bytes | 9,457 | âœ… æˆåŠŸ |
| 100K æ–‡å­— | 100,654 æ–‡å­— | 100,766 bytes | 18,840 | âœ… æˆåŠŸ |
| 200K æ–‡å­— | 201,367 æ–‡å­— | 201,479 bytes | **37,617** | âœ… æˆåŠŸ |

**æ¤œè¨¼çµæœ**: âœ… æˆåŠŸã€‚GPT-OSS 120B ã¯ **37,617 ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ200K æ–‡å­—ï¼‰**ã¾ã§å‡¦ç†å¯èƒ½ã§ã™ã€‚æ–‡å­—/ãƒˆãƒ¼ã‚¯ãƒ³æ¯”ç‡ã¯ç´„ 5.35 æ–‡å­—/ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆè‹±èªãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆï¼‰ã€‚

---

### Test 9: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

æ§˜ã€…ãªã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã§ã®æŒ™å‹•ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

#### 9-1: ã‚¼ãƒ­é™¤ç®—

**ğŸ“¤ REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 7,
  "method": "tools/call",
  "params": {
    "name": "calculator",
    "arguments": {
      "expression": "1 / 0"
    }
  }
}
```

**ğŸ“¥ RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 7,
  "error": {
    "code": -32603,
    "message": "Internal error: Invalid expression: division by zero"
  }
}
```

**æ¤œè¨¼çµæœ**: âœ… æˆåŠŸã€‚JSON-RPC 2.0 æ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ `-32603` (Internal error) ã§æ­£å¸¸ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã¾ã—ãŸã€‚

#### 9-2: å­˜åœ¨ã—ãªã„ãƒ„ãƒ¼ãƒ«

**ğŸ“¤ REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 8,
  "method": "tools/call",
  "params": {
    "name": "non_existent_tool",
    "arguments": {}
  }
}
```

**ğŸ“¥ RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 8,
  "error": {
    "code": -32603,
    "message": "Internal error: Unknown tool: non_existent_tool"
  }
}
```

**æ¤œè¨¼çµæœ**: âœ… æˆåŠŸã€‚å­˜åœ¨ã—ãªã„ãƒ„ãƒ¼ãƒ«åã‚’æŒ‡å®šã—ãŸå ´åˆã‚‚é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã¾ã—ãŸã€‚

#### 9-3: å­˜åœ¨ã—ãªã„ãƒ¡ã‚½ãƒƒãƒ‰

**ğŸ“¤ REQUEST:**

```json
{
  "jsonrpc": "2.0",
  "id": 9,
  "method": "tools/invalid_method"
}
```

**ğŸ“¥ RESPONSE:**

```json
{
  "jsonrpc": "2.0",
  "id": 9,
  "error": {
    "code": -32601,
    "message": "Method not found: tools/invalid_method"
  }
}
```

**æ¤œè¨¼çµæœ**: âœ… æˆåŠŸã€‚JSON-RPC 2.0 æ¨™æº–ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ `-32601` (Method not found) ã§æ­£å¸¸ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã¾ã—ãŸã€‚

---

## åˆ¶ç´„äº‹é …ã®ã¾ã¨ã‚

| é …ç›® | åˆ¶ç´„å€¤ | å‚™è€ƒ |
|------|-------|------|
| å¯¾å¿œãƒ¢ãƒ‡ãƒ« | GPT-OSS 20B/120B ã®ã¿ | Claude ãƒ¢ãƒ‡ãƒ«ã§ã¯åˆ©ç”¨ä¸å¯ |
| Lambda ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä¸Šé™ | 6 MBï¼ˆç†è«–å€¤ï¼‰ | å®Ÿç”¨ä¸Šã¯ 1 MB æ¨å¥¨ |
| GPT-OSS 120B ãƒˆãƒ¼ã‚¯ãƒ³æ•° | 37,617+ ãƒˆãƒ¼ã‚¯ãƒ³ | 200K æ–‡å­—ã§æ¤œè¨¼æ¸ˆã¿ |
| æ–‡å­—/ãƒˆãƒ¼ã‚¯ãƒ³æ¯”ç‡ | 5.35 æ–‡å­—/ãƒˆãƒ¼ã‚¯ãƒ³ | è‹±èªãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆ |
| ã‚¦ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ | ç´„ 22 ms | éå¸¸ã«é«˜é€Ÿ |
| Lambda ARN æŒ‡å®š | Lambda ARN ã®ã¿ | Function URLã€Step Functions ã¯éå¯¾å¿œ |
| èªè¨¼ | AWS Signature V4 | IAM ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |

---

## çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¨ã¦ã®æ¤œè¨¼ã‚’ 1 ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿè¡Œã§ãã¾ã™ã€‚

::::details run_all_tests.py ã®å®Œå…¨ãªã‚³ãƒ¼ãƒ‰

```python
"""
AWS Bedrock Responses API çµ±åˆæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å…¨ã¦ã®æ¤œè¨¼ã‚’1ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿè¡Œï¼š
1. OpenAIäº’æ›ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŸºæœ¬å‘¼ã³å‡ºã—
2. Lambda MCPçµ±åˆï¼ˆtools/list, tools/callï¼‰
3. VPC Lambda
4. ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã®ä¼æ’­
5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
6. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºä¸Šé™
7. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·ä¸Šé™
8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
"""

import json
import os
import time
import boto3
from dotenv import load_dotenv

load_dotenv()

# ç’°å¢ƒå¤‰æ•°
AWS_REGION = os.getenv('AWS_REGION', 'us-east-1')
GPT_OSS_MODEL = "openai.gpt-oss-120b-1:0"
VPC_LAMBDA_DEPLOYED = os.getenv('VPC_LAMBDA_DEPLOYED', 'false') == 'true'

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
lambda_client = boto3.client('lambda', region_name=AWS_REGION)


def print_section(title: str):
    """ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Šã‚’å‡ºåŠ›"""
    print("\n" + "=" * 80)
    print(f"  {title}")
    print("=" * 80 + "\n")


def print_request_response(request: dict, response: dict, description: str = ""):
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒšã‚¢ã§å‡ºåŠ›"""
    if description:
        print(f"ã€{description}ã€‘\n")

    print("ğŸ“¤ REQUEST:")
    print(json.dumps(request, indent=2, ensure_ascii=False))
    print()

    print("ğŸ“¥ RESPONSE:")
    print(json.dumps(response, indent=2, ensure_ascii=False))
    print()


# [å…¨ã¦ã®ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’ã“ã“ã«å«ã‚ã‚‹ - çœç•¥]

if __name__ == "__main__":
    main()
```

::::

**å®Ÿè¡Œæ–¹æ³•:**

```bash
cd /work/data-science/claudecode/bedrock-responses-api-test/test
python3 run_all_tests.py
```

**ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env` ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰:**

```bash
LAMBDA_STANDARD_ARN=arn:aws:lambda:us-east-1:XXXXXXXXXXXX:function:bedrock-mcp-standard
LAMBDA_VPC_ARN=arn:aws:lambda:us-east-1:XXXXXXXXXXXX:function:bedrock-mcp-vpc
AWS_REGION=us-east-1
VPC_LAMBDA_DEPLOYED=true
```

---

## ã¾ã¨ã‚

AWS Bedrock Responses API ã‚’æ´»ç”¨ã—ãŸ Lambda MCP çµ±åˆã®æ¤œè¨¼ã«ã‚ˆã‚Šã€ä»¥ä¸‹ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã—ãŸã€‚

**âœ… å‹•ä½œç¢ºèªã§ããŸæ©Ÿèƒ½:**

- OpenAI GPT-OSS ãƒ¢ãƒ‡ãƒ«ã§ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ Tool Use
- Lambda ARN æŒ‡å®šã«ã‚ˆã‚‹ç›´æ¥å‘¼ã³å‡ºã—
- VPC å†… Lambda ã®æ­£å¸¸å‹•ä½œ
- ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã®å®Œå…¨ä¼æ’­ï¼ˆãƒã‚¹ãƒˆæ§‹é€ ãƒ»é…åˆ—å«ã‚€ï¼‰
- é«˜é€Ÿãªãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ï¼ˆã‚¦ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã§ç´„ 22msï¼‰
- å¤§è¦æ¨¡ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ37,617 ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
- JSON-RPC 2.0 æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**âš ï¸ åˆ¶ç´„äº‹é …:**

- GPT-OSS ãƒ¢ãƒ‡ãƒ«å°‚ç”¨ï¼ˆClaude ãƒ¢ãƒ‡ãƒ«ã§ã¯åˆ©ç”¨ä¸å¯ï¼‰
- Lambda ARN ã®ã¿å¯¾å¿œï¼ˆFunction URLã€Step Functions ã¯éå¯¾å¿œï¼‰
- å®Ÿç”¨çš„ãªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºä¸Šé™ã¯ 1 MB

ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ SaaSã€é‡‘èæ©Ÿé–¢ã§ã® VPC å†…ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã€åŒ»ç™‚æ©Ÿé–¢ã§ã® HIPAA æº–æ‹ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãªã©ã€ã‚»ã‚­ãƒ¥ã‚¢ãª Tool Use å®Ÿè£…ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã‚·ãƒŠãƒªã‚ªã«ãŠã„ã¦ã€æœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ãŸå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ€§èƒ½ç‰¹æ€§ãŒå‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- AWS Bedrock Tool Use ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: https://docs.aws.amazon.com/bedrock/latest/userguide/tool-use.html
- Model Context Protocol ä»•æ§˜: https://modelcontextprotocol.io/
- AWS Lambda VPC è¨­å®šãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹: https://docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html
- JSON-RPC 2.0 ä»•æ§˜: https://www.jsonrpc.org/specification
