---
title: "AWS CloudFormation ã§ Trainium æ¤œè¨¼ç’°å¢ƒã‚’æ§‹ç¯‰"
emoji: "ğŸ§ "
type: "tech"
topics: ["AWS", "Trainium", "CloudFormation", "SageMaker", "Neuron"]
published: true
---

# ã¯ã˜ã‚ã«

AWS Trainium ã¯æ©Ÿæ¢°å­¦ç¿’ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«ç‰¹åŒ–ã—ãŸã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒ—ã§ã€ã‚³ã‚¹ãƒˆåŠ¹ç‡ã®é«˜ã„å­¦ç¿’ãƒ»æ¨è«–ç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚ã—ã‹ã—ã€Amazon SageMaker Studio ã® Code Editor ã§ã¯ Trainium ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆTrn1ã€Inf2ï¼‰ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚æœ¬è¨˜äº‹ã§ã¯ã€AWS CloudFormation ã‚’ä½¿ç”¨ã—ã¦ Trainium ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä¸Šã« Code Server æ¤œè¨¼ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚æœ¬æ ¼çš„ãªæ¨è«–ã‚„å­¦ç¿’ã‚’å®Ÿæ–½ã™ã‚‹å‰ã«è»½ãæŒ™å‹•ã‚’ç¢ºèªã—ãŸã„ã‚ˆã†ãªå ´åˆã«ä¾¿åˆ©ã ã¨æ€ã„ã¾ã™ã€‚

**GitHub ãƒªãƒã‚¸ãƒˆãƒª:**
https://github.com/littlemex/samples/tree/main/aws-neuron/torch-neuron/multi-framework-dlami-ubuntu22

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart LR
    A[CloudFront] --> B[code-server<br/>Port 80]
    B --> C[Trn1 Instance<br/>Neuron DLAMI]
    C --> D[NeuronCore x2]
    
    style C fill:#ffe1e1
    style D fill:#ffd1d1
```

ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š

- **Trn1 ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**: Neuron Multi-Framework DLAMI ã‚’ä½¿ç”¨
- **code-server**: ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ã® VS Code ç’°å¢ƒ
- **CloudFront**: ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ã‚¯ã‚»ã‚¹æä¾›
- **SSM**: ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†

## Neuron DLAMI ã®æ´»ç”¨

[Neuron Deep Learning AMIï¼ˆDLAMIï¼‰](https://awsdocs-neuron.readthedocs-hosted.com/en/latest/dlami/index.html)ã¯ã€Neuron SDK ãŒãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸ AMI ã§ã™ã€‚Ubuntu 22.04 ã® Multi-Framework DLAMI ã«ã¯ã€ä¸€ä¾‹ã¨ã—ã¦ä»¥ä¸‹ã®ä»®æƒ³ç’°å¢ƒãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

- **PyTorch 2.8 TorchNeuronX**: `/opt/aws_neuronx_venv_pytorch_2_8`
- **JAX 0.7 NeuronX**: `/opt/aws_neuronx_venv_jax_0_7`

ã“ã‚Œã‚‰ã®ç’°å¢ƒã¯ã€Neuron ãƒ‰ãƒ©ã‚¤ãƒã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã™ã¹ã¦å«ã¾ã‚Œã¦ãŠã‚Šã€ã™ãã«ä½¿ç”¨ã§ãã¾ã™ã€‚

å‚ç…§: [Get Started with Neuron on Ubuntu 22 with DLAMI](https://awsdocs-neuron.readthedocs-hosted.com/en/latest/setup/neuron-setup/multiframework/multi-framework-ubuntu22-neuron-dlami.html)

# ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

## å‰ææ¡ä»¶

- AWS CLI ãŒè¨­å®šæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨
- é©åˆ‡ãª IAM æ¨©é™ãŒã‚ã‚‹ã“ã¨

## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/littlemex/samples.git
cd aws-neuron/torch-neuronx/multi-framework-dlami-ubuntu22

# CloudFormation ã‚¹ã‚¿ãƒƒã‚¯ã®ãƒ‡ãƒ—ãƒ­ã‚¤
./cfn_manager.sh create
```

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã™ã‚‹ã¨ã€CloudFormation ã® Outputs ã« code-server ã® URL ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## ä½¿ç”¨æ–¹æ³•

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Neuron ç’°å¢ƒã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆã§ãã¾ã™ï¼š

```bash
# PyTorch NeuronX ç’°å¢ƒã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
source /opt/aws_neuronx_venv_pytorch_2_8/bin/activate

# ã¾ãŸã¯ alias ã‚’ä½¿ç”¨ï¼ˆ.bashrc ã«è¨­å®šæ¸ˆã¿ï¼‰
neuron-activate
```

# ã¾ã¨ã‚

CloudFormation ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€Neuron DLAMI ãƒ™ãƒ¼ã‚¹ã®é–‹ç™ºç’°å¢ƒã‚’ç°¡å˜ã«æ§‹ç¯‰ã§ãã¾ã™ã€‚DLAMI ã«ã¯ PyTorchã€JAXã€vLLM ãªã©è¤‡æ•°ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€ã™ãã«é–‹ç™ºã‚’é–‹å§‹ã§ãã¾ã™ã€‚æ¬¡ã®å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã® Karakuri ã® AWS Trainium 50 æœ¬ãƒãƒƒã‚¯ãŒãŠã™ã™ã‚ã§ã™ã€‚

https://zenn.dev/karakuri_blog/articles/77d93c40b27b60

## å‚è€ƒãƒªãƒ³ã‚¯

- [Neuron DLAMI User Guide](https://awsdocs-neuron.readthedocs-hosted.com/en/latest/dlami/index.html)
- [Get Started with Neuron on Ubuntu 22 with DLAMI](https://awsdocs-neuron.readthedocs-hosted.com/en/latest/setup/neuron-setup/multiframework/multi-framework-ubuntu22-neuron-dlami.html)